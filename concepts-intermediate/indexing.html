<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indexing</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/concepts.css">
</head>
<body class="indexing-page">
    <a href="/" class="home-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
        Home
    </a>

    <div class="container">
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 40px; height: 40px; display: inline-block; margin-right: 10px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"/></svg>
            Indexing
        </h1>

        <div class="intro-box">
            <p>Indexes are data structures that speed up data retrieval at the cost of additional storage and write overhead. They're critical for query performance but require careful design and maintenance.</p>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"/></svg>
            Why Indexes Matter
        </h2>
        <div class="architecture-grid">
            <div class="arch-card">
                <h3>Without Index</h3>
                <ul class="features-list">
                    <li>Full table scan: O(n) reads</li>
                    <li>Slow on large datasets</li>
                    <li>Every row examined</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>With Index</h3>
                <ul class="features-list">
                    <li>Direct lookup: O(log n) or O(1)</li>
                    <li>Fast even with millions of rows</li>
                    <li>Only relevant rows scanned</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Trade-off</h3>
                <ul class="features-list">
                    <li>Faster reads, slower writes</li>
                    <li>Extra storage space</li>
                    <li>Index maintenance overhead</li>
                </ul>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
            Types of Indexes
        </h2>
        <div class="architecture-grid">
            <div class="arch-card">
                <h3>B-Tree (Default)</h3>
                <p><strong>Most common:</strong> PostgreSQL, MySQL, MongoDB</p>
                <ul class="features-list">
                    <li>Balanced tree structure</li>
                    <li>Efficient for equality & range queries</li>
                    <li>ORDER BY optimization</li>
                    <li>Use for: WHERE, JOIN, ORDER BY</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Hash Index</h3>
                <p><strong>Fast equality checks</strong></p>
                <ul class="features-list">
                    <li>O(1) lookup for exact match</li>
                    <li>No range queries</li>
                    <li>Use for: unique lookups (user by email)</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Full-Text Index</h3>
                <p><strong>Search text content</strong></p>
                <ul class="features-list">
                    <li>Tokenizes and indexes words</li>
                    <li>Supports LIKE, MATCH queries</li>
                    <li>Ranking and relevance scoring</li>
                    <li>Use for: search boxes, content filtering</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Geospatial Index</h3>
                <p><strong>Location queries</strong></p>
                <ul class="features-list">
                    <li>2D/3D spatial data</li>
                    <li>Nearby/radius queries</li>
                    <li>Use for: maps, store locators</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Unique Index</h3>
                <p><strong>Enforce uniqueness</strong></p>
                <ul class="features-list">
                    <li>Prevents duplicate values</li>
                    <li>Often on primary/foreign keys</li>
                    <li>Use for: email, username, IDs</li>
                </ul>
            </div>
            <div class="arch-card">
                <h3>Partial Index</h3>
                <p><strong>Index subset of rows</strong></p>
                <ul class="features-list">
                    <li>WHERE clause filter</li>
                    <li>Smaller, faster index</li>
                    <li>Use for: active_users only</li>
                </ul>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5"/></svg>
            Creating Indexes
        </h2>
        <div style="background: rgba(102, 126, 234, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 25px; margin: 30px 0; display: grid; gap: 18px;">
            <div>
                <h3>SQL — Single Column Index</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
CREATE INDEX idx_users_email ON users(email);
-- Speeds up: SELECT * FROM users WHERE email = 'user@example.com';
                </div>
            </div>
            <div>
                <h3>SQL — Composite (Multi-Column) Index</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
CREATE INDEX idx_orders_customer_date ON orders(customer_id, created_at);
-- Speeds up: WHERE customer_id = 123 AND created_at > '2025-01-01'
-- Also helps: WHERE customer_id = 123 (leftmost prefix rule)
-- Does NOT help: WHERE created_at > '2025-01-01' alone
                </div>
            </div>
            <div>
                <h3>SQL — Unique Index</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
CREATE UNIQUE INDEX idx_users_username ON users(username);
-- Enforces uniqueness + speeds up lookups
                </div>
            </div>
            <div>
                <h3>SQL — Partial Index (PostgreSQL)</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
CREATE INDEX idx_active_users ON users(email) WHERE status = 'active';
-- Smaller index; only active users indexed
                </div>
            </div>
            <div>
                <h3>MongoDB — Single Field Index</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
db.users.createIndex({ email: 1 });
// 1 = ascending, -1 = descending
                </div>
            </div>
            <div>
                <h3>MongoDB — Compound Index</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
db.orders.createIndex({ customer_id: 1, created_at: -1 });
// Supports queries on customer_id or (customer_id + created_at)
                </div>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"/></svg>
            Composite Index: Leftmost Prefix Rule
        </h2>
        <div class="intro-box">
            <p>For composite index <code>idx(A, B, C)</code>, the DB can use it for queries on:</p>
            <ul class="features-list">
                <li><strong>A</strong> alone</li>
                <li><strong>A, B</strong> together</li>
                <li><strong>A, B, C</strong> together</li>
            </ul>
            <p>But <strong>not</strong> for <code>B</code> alone, <code>C</code> alone, or <code>B, C</code> without <code>A</code>.</p>
        </div>
        <div style="background: #1e1e1e; color: #d4d4d4; padding: 14px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; border: 1px solid rgba(255,255,255,0.1); white-space: pre-wrap; overflow-wrap: break-word; margin-top: 16px;">
-- Given: CREATE INDEX idx_orders ON orders(customer_id, status, created_at);

-- ✅ Uses index
SELECT * FROM orders WHERE customer_id = 123;
SELECT * FROM orders WHERE customer_id = 123 AND status = 'shipped';
SELECT * FROM orders WHERE customer_id = 123 AND status = 'shipped' AND created_at > '2025-01-01';

-- ❌ Does NOT use index (missing leftmost column)
SELECT * FROM orders WHERE status = 'shipped';
SELECT * FROM orders WHERE created_at > '2025-01-01';
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"/></svg>
            Covering Index
        </h2>
        <div class="intro-box">
            <p>A <strong>covering index</strong> includes all columns needed by the query, so the DB never touches the table itself. Ultra-fast.</p>
        </div>
        <div style="background: #1e1e1e; color: #d4d4d4; padding: 14px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; border: 1px solid rgba(255,255,255,0.1); white-space: pre-wrap; overflow-wrap: break-word; margin-top: 16px;">
-- Query: SELECT email, status FROM users WHERE email = 'user@example.com';
-- Index: CREATE INDEX idx_users_email_status ON users(email, status);
-- Result: DB reads only index; no table lookup needed (index-only scan)
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"/></svg>
            Analyzing Query Plans
        </h2>
        <div style="background: rgba(102, 126, 234, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 25px; margin: 30px 0; display: grid; gap: 18px;">
            <div>
                <h3>SQL — EXPLAIN</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
EXPLAIN SELECT * FROM users WHERE email = 'user@example.com';
-- Look for: Index Scan vs Seq Scan (full table scan = slow)
-- PostgreSQL: EXPLAIN ANALYZE shows actual runtime
                </div>
            </div>
            <div>
                <h3>MongoDB — explain()</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
db.users.find({ email: 'user@example.com' }).explain('executionStats');
// Look for: IXSCAN (index) vs COLLSCAN (collection scan = slow)
// Check totalDocsExamined vs nReturned
                </div>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"/></svg>
            Best Practices
        </h2>
        <div class="pros-box">
            <h3>Do this:</h3>
            <ul class="features-list">
                <li>Index foreign keys and WHERE/JOIN columns</li>
                <li>Use composite indexes for multi-column queries</li>
                <li>Put most selective column first in composite index</li>
                <li>Create covering indexes for hot queries</li>
                <li>Use partial indexes to reduce size when possible</li>
                <li>Monitor slow query logs and add indexes as needed</li>
                <li>Drop unused indexes (check DB stats)</li>
                <li>Rebuild/reindex periodically to reduce fragmentation</li>
                <li>Use EXPLAIN to verify index usage</li>
            </ul>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0zm-9 3.75h.008v.008H12v-.008z"/></svg>
            Common Pitfalls
        </h2>
        <div class="cons-box">
            <h3>Avoid these:</h3>
            <ul class="features-list">
                <li>Over-indexing: every index slows down writes</li>
                <li>Indexing low-cardinality columns (e.g., boolean, few distinct values)</li>
                <li>Missing composite index when querying multiple columns together</li>
                <li>Wrong column order in composite index (violates leftmost prefix)</li>
                <li>Using functions in WHERE (e.g., WHERE LOWER(email) = ...) breaks index</li>
                <li>Ignoring index size; massive indexes hurt cache and memory</li>
                <li>No monitoring of index usage or query performance</li>
                <li>Forgetting to add index when adding new query patterns</li>
            </ul>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
            When NOT to Index
        </h2>
        <div class="architecture-grid">
            <div class="arch-card">
                <h3>Small Tables</h3>
                <p>Full scan is faster than index lookup for tiny tables (&lt;1000 rows).</p>
            </div>
            <div class="arch-card">
                <h3>Write-Heavy Tables</h3>
                <p>High insert/update rate; minimize indexes to avoid write penalty.</p>
            </div>
            <div class="arch-card">
                <h3>Low Selectivity</h3>
                <p>Columns with few distinct values (is_active: true/false) rarely benefit.</p>
            </div>
            <div class="arch-card">
                <h3>Rarely Queried</h3>
                <p>Don't index columns never used in WHERE/JOIN/ORDER BY.</p>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"/></svg>
            Index Maintenance
        </h2>
        <div class="architecture-grid">
            <div class="arch-card">
                <h3>Fragmentation</h3>
                <p>Over time, indexes become fragmented. Rebuild/reorganize periodically.</p>
            </div>
            <div class="arch-card">
                <h3>Statistics</h3>
                <p>DB query planner uses stats to choose indexes. Update stats regularly (ANALYZE).</p>
            </div>
            <div class="arch-card">
                <h3>Monitoring</h3>
                <p>Track index usage, size, and fragmentation. Drop unused indexes.</p>
            </div>
            <div class="arch-card">
                <h3>Online Reindex</h3>
                <p>Some DBs support concurrent index rebuilds without locking table.</p>
            </div>
        </div>

        <div class="intro-box" style="text-align: center; margin: 60px 0 40px;">
            <p>Indexes are powerful but not free. Start with foreign keys and frequent WHERE clauses, measure query performance, and add indexes based on real usage patterns. Less is often more.</p>
        </div>
    </div>
</body>
</html>
