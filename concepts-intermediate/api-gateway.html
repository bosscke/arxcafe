<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Gateway</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/concepts.css">
</head>
<body class="api-gateway-page">
    <a href="/" class="home-btn">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
        Home
    </a>

    <div class="container">
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 40px; height: 40px; display: inline-block; margin-right: 10px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18m-9 0h18M3 12h18"/></svg>
            API Gateway
        </h1>

        <div class="intro-box">
            <p>An <strong>API Gateway</strong> is a single entry point for clients. It handles <strong>routing</strong>, <strong>authentication</strong>, <strong>rate-limiting</strong>, <strong>aggregation</strong>, and <strong>protocol translation</strong>, simplifying client access to many backend services.</p>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12h12M6 6h12M6 18h12"/></svg>
            Core Responsibilities
        </h2>

        <div class="architecture-grid">
            <div class="arch-card">
                <h3>Routing</h3>
                <p>Map incoming paths to services; support canary and blue/green.</p>
            </div>
            <div class="arch-card">
                <h3>Auth & Security</h3>
                <p>JWT/OAuth validation, API keys, mTLS, CORS, and request validation.</p>
            </div>
            <div class="arch-card">
                <h3>Rate Limiting</h3>
                <p>Protect backends via quotas, throttling, concurrency caps, and back-pressure.</p>
            </div>
            <div class="arch-card">
                <h3>Aggregation</h3>
                <p>Combine multiple service responses to reduce client round-trips.</p>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="m6.75 7.5 4.5 9 4.5-9m-9 0 4.5-4.5 4.5 4.5m-9 0h9m-9 0L3 12l3.75-4.5m9 0L21 12l-3.75-4.5"/></svg>
            Patterns
        </h2>

        <div class="architecture-grid">
            <div class="arch-card">
                <h3>BFF (Backend For Frontend)</h3>
                <p>Tailored gateway per client (web/mobile) with optimized endpoints.</p>
            </div>
            <div class="arch-card">
                <h3>Edge vs Service</h3>
                <p>Edge gateway in front of the platform; internal service mesh for service-to-service.</p>
            </div>
            <div class="arch-card">
                <h3>Hybrid</h3>
                <p>Combine Kong/Nginx at edge with mesh (Istio/Linkerd) inside the cluster.</p>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 3h3m-6 3h6M6.75 6h10.5a2.25 2.25 0 0 1 2.25 2.25v9A2.25 2.25 0 0 1 17.25 19.5H6.75A2.25 2.25 0 0 1 4.5 17.25v-9A2.25 2.25 0 0 1 6.75 6z"/></svg>
            Examples
        </h2>

        <div style="background: rgba(102, 126, 234, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 25px; margin: 30px 0; display: grid; gap: 18px;">
            <div>
                <h3>Node.js Express Gateway</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
// api-gateway/server.js
const express = require('express');
const proxy = require('express-http-proxy');
const jwt = require('jsonwebtoken');
const app = express();

// simple JWT auth middleware
app.use((req, res, next) => {
  const token = req.headers['authorization']?.replace('Bearer ', '');
  if (!token) return res.status(401).json({ error: 'Missing token' });
  try { jwt.verify(token, process.env.JWT_PUBLIC_KEY || 'dev-secret'); next(); }
  catch { return res.status(401).json({ error: 'Invalid token' }); }
});

// rate limit demo (very naive)
let calls = 0; const LIMIT = 100;
app.use((req,res,next)=>{ calls++; if(calls>LIMIT) return res.status(429).json({error:'rate limit'}); next(); });

// routing
app.use('/users', proxy('http://user-service:4001'));
app.use('/orders', proxy('http://order-service:4002'));

// aggregation endpoint
app.get('/dashboard', async (req,res)=>{
  const fetch = (await import('node-fetch')).default;
  const [u, o] = await Promise.all([
    fetch('http://user-service:4001/users/me').then(r=>r.json()),
    fetch('http://order-service:4002/orders/recent').then(r=>r.json())
  ]);
  res.json({ user: u, orders: o });
});

app.listen(4000);
                </div>
            </div>
            <div>
                <h3>Nginx Gateway (reverse proxy)</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6; overflow-wrap: break-word; word-wrap: break-word; border: 1px solid rgba(255, 255, 255, 0.1); white-space: pre-wrap; max-width: 100%; box-sizing: border-box;">
# nginx.conf (simplified)
http {
  upstream user_service { server user-service:4001; }
  upstream order_service { server order-service:4002; }
  server {
    listen 80;
    location /users { proxy_pass http://user_service; }
    location /orders { proxy_pass http://order_service; }
    # CORS and headers
    add_header Access-Control-Allow-Origin *;
  }
}
                </div>
            </div>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"/></svg>
            Best Practices
        </h2>

        <div class="pros-box">
            <h3>Do this:</h3>
            <ul class="features-list">
                <li>Centralize auth, rate limits, and request validation</li>
                <li>Use request IDs; propagate for tracing across services</li>
                <li>Cache safe GETs at the edge to reduce load</li>
                <li>Prefer async aggregation when results can be eventual</li>
                <li>Keep configs declarative and versioned (GitOps)</li>
            </ul>
        </div>

        <h2>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px; display: inline-block; margin-right: 8px; vertical-align: middle;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0zm-9 3.75h.008v.008H12v-.008z"/></svg>
            Common Pitfalls
        </h2>

        <div class="cons-box">
            <h3>Avoid these:</h3>
            <ul class="features-list">
                <li>Gateway doing business logic (keep it thin)</li>
                <li>Unversioned routes causing breaking changes</li>
                <li>Overuse of sync aggregation causing latency spikes</li>
                <li>Missing rate limits leading to backend overload</li>
            </ul>
        </div>

        <div class="intro-box" style="text-align: center; margin: 60px 0 40px;">
            <p>API Gateways streamline access to complex platforms. Keep them secure, observable, and focused on cross-cutting concernsâ€”not business logic.</p>
        </div>
    </div>
</body>
</html>
