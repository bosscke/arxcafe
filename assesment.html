<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment ‚Ä¢ ArxCafe</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%231f2a44'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' font-size='34'%3Eüç∞%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/elearn.css">
</head>
<body class="assessment-page">
    <div class="app-shell">
        <header class="topbar">
            <div class="topbar-inner">
                <button class="icon-btn" id="menuBtn" aria-label="Menu">‚ò∞</button>
                <div class="brand">
                    ArxCafe
                    <small>Assessment</small>
                </div>
                <div class="avatar" id="avatar" aria-label="Profile">AR</div>
            </div>
        </header>

        <div class="drawer" id="drawer" aria-hidden="true">
            <div class="drawer-backdrop" id="drawerBackdrop"></div>
            <nav class="drawer-panel" aria-label="Menu">
                <div class="drawer-title">Menu</div>
                <a class="drawer-link" href="/"><strong>Home</strong><span>‚Üí</span></a>
                <a class="drawer-link" href="/concepts/http-methods.html"><strong>Learn</strong><span>‚Üí</span></a>
                <a class="drawer-link" href="/paywall" id="paywallLink"><strong>Unlock</strong><span>‚Üí</span></a>
                <a class="drawer-link" href="/logout"><strong>Logout</strong><span>‚Üí</span></a>

                <a class="drawer-link" href="/admin" id="adminMenuLink" style="display:none"><strong>Admin</strong><span>‚Üí</span></a>
            </nav>
        </div>

        <main class="main">
            <div class="container">
                <section class="hero">
                    <h1>Professional Machine Learning Engineer</h1>
                    <p>Quizzes, progress tracking, and focused practice ‚Äî mobile-first.</p>
                    <div class="cta-row">
                        <a class="btn-primary" href="/ml-engineer-quiz.html" id="primaryCta">Start / Continue Quiz</a>
                        <a class="btn-secondary" href="/concepts/http-status-codes.html">Concept Review</a>
                    </div>
                </section>

                <section class="section">
                    <div class="card card-pad">
                        <p class="progress-title">
                            Progress
                            <span id="progressPct">‚Äî</span>
                        </p>
                        <div class="progress-sub" id="progressSub">Loading status‚Ä¶</div>
                        <div class="progress-track" aria-hidden="true"><div class="progress-fill" id="progressFill"></div></div>
                        <div class="stats">
                            <div class="stat"><strong id="attemptsCount">‚Äî</strong><span>Attempts</span></div>
                            <div class="stat"><strong id="bestPct">‚Äî</strong><span>Best score</span></div>
                            <div class="stat"><strong id="streakDays">‚Äî</strong><span>Streak</span></div>
                            <div class="stat"><strong id="lastAttempt">‚Äî</strong><span>Last attempt</span></div>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <h2>Actions</h2>
                    <div class="cards">
                        <a class="action" href="/ml-engineer-quiz.html" id="cardQuiz">
                            <div class="action-icon">Q</div>
                            <div>
                                <h3>Practice Questions</h3>
                                <p>Timed quiz runs + instant feedback.</p>
                            </div>
                        </a>

                        <a class="action" href="/concepts/http-methods.html">
                            <div class="action-icon">L</div>
                            <div>
                                <h3>Concept Review</h3>
                                <p>Short, structured notes for quick recall.</p>
                            </div>
                        </a>

                        <div class="action locked" id="cardMock" role="link" aria-disabled="true" tabindex="0">
                            <div class="action-icon">üîí</div>
                            <div>
                                <h3>Mock Exam <span class="lock-pill">Locked</span></h3>
                                <p>Full-length simulation + detailed analytics.</p>
                                <div class="lock-cta"><a href="/paywall?next=%2Fml-engineer-quiz.html" id="unlockCta">Unlock via payment</a></div>
                            </div>
                        </div>

                        <div class="action locked" id="cardAnalytics" role="link" aria-disabled="true" tabindex="0">
                            <div class="action-icon">üîí</div>
                            <div>
                                <h3>Results / Analytics <span class="lock-pill">Locked</span></h3>
                                <p>Accuracy trends, weak domains, streaks.</p>
                                <div class="lock-cta"><a href="/paywall?next=%2Fanalytics.html">Unlock analytics</a></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section" style="margin-top: 16px;">
                    <a class="btn-secondary" href="/">Back to Home</a>
                    <div id="admin-link" style="display:none; margin-top: 10px;">
                        <a class="btn-secondary" href="/admin">Admin Dashboard</a>
                    </div>
                </section>
            </div>
        </main>

        <nav class="bottom-nav" aria-label="Bottom navigation">
            <div class="bottom-inner">
                <a class="nav-item" href="/" aria-label="Home">
                    <span class="dot">üè†</span>
                    Home
                </a>
                <a class="nav-item" href="/concepts/http-methods.html" aria-label="Learn">
                    <span class="dot">üìö</span>
                    Learn
                </a>
                <a class="nav-item active" href="/assesment.html" aria-label="Quiz">
                    <span class="dot">üìù</span>
                    Quiz
                </a>
                <a class="nav-item" href="/profile.html" aria-label="Profile">
                    <span class="dot">üë§</span>
                    Profile
                </a>
            </div>
        </nav>
    </div>

    <script>
        (function () {
            const drawer = document.getElementById('drawer');
            const menuBtn = document.getElementById('menuBtn');
            const backdrop = document.getElementById('drawerBackdrop');

            function openDrawer() {
                drawer.classList.add('open');
                drawer.setAttribute('aria-hidden', 'false');
            }

            function closeDrawer() {
                drawer.classList.remove('open');
                drawer.setAttribute('aria-hidden', 'true');
            }

            menuBtn?.addEventListener('click', openDrawer);
            backdrop?.addEventListener('click', closeDrawer);
        })();

        (async function () {
            try {
                const res = await fetch('/api/access', { credentials: 'same-origin' });
                const data = await res.json();

                // Set admin menu link visibility
                if (data && data.authenticated && data.role === 'admin') {
                    const adminMenuLink = document.getElementById('adminMenuLink');
                    if (adminMenuLink) adminMenuLink.style.display = 'flex';
                }

                const paid = !!(data && data.authenticated && data.paid);
                const analyticsCard = document.getElementById('cardAnalytics');

                // Quiz is available for any logged-in user.
                // Keep analytics as paid-only.
                if (!paid) {
                    if (analyticsCard) {
                        analyticsCard.addEventListener('click', () => { window.location.href = '/paywall?next=%2Fanalytics.html'; });
                    }
                } else {
                    if (analyticsCard) {
                        analyticsCard.classList.remove('locked');
                        analyticsCard.removeAttribute('aria-disabled');
                        analyticsCard.tabIndex = 0;
                        analyticsCard.addEventListener('click', () => { window.location.href = '/analytics.html'; });
                        analyticsCard.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') window.location.href = '/analytics.html';
                        });
                    }
                }
            } catch (e) {
                // ignore
            }
        })();

        (async function () {
            try {
                const [progressRes, streakRes] = await Promise.all([
                    fetch('/api/quiz/progress', { credentials: 'same-origin' }),
                    fetch('/api/quiz/streak', { credentials: 'same-origin' }),
                ]);

                const data = await progressRes.json();
                const streak = await streakRes.json().catch(() => ({ ok: false }));
                if (!data || !data.ok) return;

                const pct = Number.isFinite(data.lastPercentage) ? data.lastPercentage : 0;
                const best = Number.isFinite(data.bestPercentage) ? data.bestPercentage : null;
                const attempts = Number.isFinite(data.attempts) ? data.attempts : 0;

                const pctEl = document.getElementById('progressPct');
                const fillEl = document.getElementById('progressFill');
                const subEl = document.getElementById('progressSub');
                const attemptsEl = document.getElementById('attemptsCount');
                const bestEl = document.getElementById('bestPct');
                const streakEl = document.getElementById('streakDays');
                const lastAttemptEl = document.getElementById('lastAttempt');

                if (pctEl) pctEl.textContent = `${pct}%`;
                if (fillEl) fillEl.style.width = `${Math.max(0, Math.min(100, pct))}%`;
                if (attemptsEl) attemptsEl.textContent = String(attempts);
                if (bestEl) bestEl.textContent = best === null ? '‚Äî' : `${best}%`;

                if (streakEl && streak?.ok) {
                    const s = Number.isFinite(streak.currentStreak) ? streak.currentStreak : 0;
                    streakEl.textContent = s ? `${s} day${s === 1 ? '' : 's'}` : '‚Äî';
                }

                if (lastAttemptEl && data?.lastAt) {
                    try {
                        const d = new Date(data.lastAt);
                        lastAttemptEl.textContent = isNaN(d.getTime()) ? '‚Äî' : d.toLocaleDateString();
                    } catch {
                        lastAttemptEl.textContent = '‚Äî';
                    }
                }

                if (subEl) subEl.textContent = attempts ? 'Keep going ‚Äî consistency wins.' : 'Start your first attempt to begin tracking.';
            } catch (e) {
                // ignore
            }
        })();

        (async function () {
            try {
                const res = await fetch('/api/me', { credentials: 'same-origin' });
                const data = await res.json();
                if (data && data.authenticated && data.role === 'admin') {
                    const el = document.getElementById('admin-link');
                    if (el) el.style.display = 'block';
                }
            } catch (e) {
                // ignore
            }
        })();
    </script>
</body>
</html>
